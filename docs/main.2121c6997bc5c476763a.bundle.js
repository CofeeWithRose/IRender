(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return startFPS})),__webpack_require__.d(__webpack_exports__,"b",(function(){return stopFPS}));var id=0;function startFPS(){var frameCount=0,fpsDiv=document.querySelector("#fps"),lastTime=performance.now(),caculateFps=function(){frameCount++;var now=performance.now();if(1e3<=now-lastTime){var preFrameSeconds=.001*(now-lastTime)/frameCount;fpsDiv.innerHTML="fps: "+Math.round(1/preFrameSeconds),frameCount=0,lastTime=now}id=requestAnimationFrame(caculateFps)};caculateFps()}function stopFPS(){cancelAnimationFrame(id)}},353:function(module,exports,__webpack_require__){var api=__webpack_require__(198),content=__webpack_require__(928);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},355:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/stand1.36f1dfdd.png"},356:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/run1.87fc1d39.png"},357:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/run2.fa793523.png"},358:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/run3.1032c29f.png"},359:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/run4.b373cea5.png"},360:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/run5.e5de65d2.png"},361:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/run6.2f405595.png"},362:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/run7.94df8469.png"},363:function(module,exports,__webpack_require__){__webpack_require__(364),__webpack_require__(729),module.exports=__webpack_require__(730)},499:function(module,exports){},730:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _storybook_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(354);module._StorybookPreserveDecorators=!0,Object(_storybook_react__WEBPACK_IMPORTED_MODULE_0__.configure)([__webpack_require__(921)],module)}.call(this,__webpack_require__(731)(module))},84:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return core_IRender}));var SHADER_TYPE,Iimage=function(){function Iimage(update){this.update=update,this.position=[0,0],this.color=[255,255,255,1],this.zIndex=0,this.scale=[1,1],this.rotation=0,this.offset=[0,0],this.size=[100,100],this.texTureSize=[0,0],this.elementSize=[0,0]}return Iimage.prototype.setPosition=function(x,y){this.position[0]=x,this.position[1]=y,this.update.updatePosition(this.elementIndex,this.position)},Iimage.prototype.setImgId=function(imgId){this.imgId=imgId,this.update.updateImg(this.elementIndex,this.imgId)},Iimage.prototype.setColor=function(r,g,b,a){this.color[0]=r,this.color[1]=g,this.color[2]=b,this.color[3]=a,this.update.updateColor(this.elementIndex,this.color)},Iimage.prototype.setZIndex=function(zIndex){this.zIndex!==zIndex&&(this.zIndex=zIndex,this.update.updateZindex())},Iimage.prototype.setRotation=function(rotation){this.rotation=rotation,this.update.updateRotation(this.elementIndex,rotation)},Iimage.prototype.setScale=function(scaleX,scaleY){this.scale[0]=scaleX,this.scale[1]=scaleY,this.setScaledSize(this.elementSize[0],this.elementSize[1]),this.update.updateScale(this.elementIndex,this.scale)},Iimage.prototype.setOffset=function(offsetX,offsetY){this.offset[0]=offsetX,this.offset[1]=offsetY,this.update.updateOffset(this.elementIndex,this.offset)},Iimage.prototype.setTextureSize=function(w,h){this.texTureSize[0]=w,this.texTureSize[1]=h},Iimage.prototype.setElelmentSize=function(w,h){this.elementSize[0]=w,this.elementSize[1]=h},Iimage.prototype.setScaledSize=function(w,h){this.size[0]=w*this.scale[0],this.size[1]=h*this.scale[1]},Iimage.prototype.setSize=function(w,h){this.setElelmentSize(w,h),this.setScaledSize(w,h),this.update.updateSize(this.elementIndex,this.elementSize)},Iimage}();function compileShader(gl,program,source,type){var _a,map=((_a={})[SHADER_TYPE.VERTEX_SHADER]=gl.VERTEX_SHADER,_a[SHADER_TYPE.FRAGMENT_SHADER]=gl.FRAGMENT_SHADER,_a),shader=gl.createShader(map[type]);return gl.shaderSource(shader,source),gl.compileShader(shader),console.log("compile shader success:",gl.getShaderParameter(shader,gl.COMPILE_STATUS)),console.log("compile log",gl.getShaderInfoLog(shader)),gl.attachShader(program,shader),shader}!function(SHADER_TYPE){SHADER_TYPE.VERTEX_SHADER="VERTEX_SHADER",SHADER_TYPE.FRAGMENT_SHADER="FRAGMENT_SHADER"}(SHADER_TYPE||(SHADER_TYPE={}));var I_ELEMENT_TYPES,TextureCanvasManager=function(){function TextureCanvasManager(size){var _this=this;void 0===size&&(size=2048),this.curX=1,this.curY=1,this.curMaxHeight=0,this.pading=1,this.positionInfo={},this.id=0,this.checkSpace=function(w,h){_this.canvas.width-_this.curX<w&&_this.movePosition(w,h)},this.movePosition=function(w,h){_this.curMaxHeight<h&&(_this.curMaxHeight=h);var nextX=_this.curX+w+_this.pading;nextX>=_this.canvas.width?(_this.curX=_this.pading,_this.curY+=_this.curMaxHeight+_this.pading,_this.curMaxHeight=0):_this.curX=nextX},this.canvas=document.createElement("canvas"),this.canvas.width=size,this.canvas.height=size,this.ctx=this.canvas.getContext("2d")}return TextureCanvasManager.prototype.setImage=function(img){var id=this.id++;return this.checkSpace(img.width,img.height),this.ctx.drawImage(img,this.curX,this.curY,img.width,img.height),this.positionInfo[id]={x:this.curX,y:this.curY,w:img.width,h:img.height},this.movePosition(img.width,img.height),id},TextureCanvasManager.prototype.getImageInfo=function(imgId){return this.positionInfo[imgId]},TextureCanvasManager}();!function(I_ELEMENT_TYPES){I_ELEMENT_TYPES.I_IMAGE="I_IMAGE"}(I_ELEMENT_TYPES||(I_ELEMENT_TYPES={}));var __assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},DEFAULT_OPTION={maxNumber:5e4,textureSize:2048,backgroundColor:[0,0,0,0]},core_IRender=function(){function IRender(glCanvas,options){var _a,_this=this;this.glCanvas=glCanvas,this.elementList=[],this.GLElemetMap=((_a={})[I_ELEMENT_TYPES.I_IMAGE]=Iimage,_a),this.positionBufferChanged=!1,this.imageIdBufferChanged=!1,this.colorBufferChanged=!1,this.textureChange=!0,this.zIndexChange=!1,this.scaleChange=!1,this.rotationChange=!1,this.sizeChanged=!1,this.rafing=!1,this.elementPool=new Set,this.getTexture=function(){return _this.textureManager.canvas},this.bufferData=function(target,glBuffer,data){_this.gl.bindBuffer(target,glBuffer),_this.gl.bufferSubData(target,0,data)},this.updateImidiatly=function(){var _a;_this.handleZindexChange(),_this.positionBufferChanged&&_this.bufferData(_this.gl.ARRAY_BUFFER,_this.attrBuffer.a_position,_this.attrData.a_position),_this.imageIdBufferChanged&&_this.bufferData(_this.gl.ARRAY_BUFFER,_this.attrBuffer.a_texCoord,_this.attrData.a_texCoord),_this.sizeChanged&&_this.bufferData(_this.gl.ARRAY_BUFFER,_this.attrBuffer.a_spriteSize,_this.attrData.a_spriteSize),_this.colorBufferChanged&&_this.bufferData(_this.gl.ARRAY_BUFFER,_this.attrBuffer.a_color,_this.attrData.a_color),_this.scaleChange&&_this.bufferData(_this.gl.ARRAY_BUFFER,_this.attrBuffer.a_scale,_this.attrData.a_scale),_this.rotationChange&&_this.bufferData(_this.gl.ARRAY_BUFFER,_this.attrBuffer.a_rotation,_this.attrData.a_rotation),_this.checkReloadTexure(),(_a=_this.gl).clearColor.apply(_a,_this.options.backgroundColor),_this.gl.clear(_this.gl.COLOR_BUFFER_BIT|_this.gl.DEPTH_BUFFER_BIT),_this.gl.drawElements(_this.gl.TRIANGLES,6*_this.elementList.length,_this.gl.UNSIGNED_INT,0),_this.imageIdBufferChanged=!1,_this.positionBufferChanged=!1,_this.textureChange=!1,_this.colorBufferChanged=!1,_this.sizeChanged=!1},this.checkReloadTexure=function(){_this.textureChange&&(_this.gl.bindTexture(_this.gl.TEXTURE_2D,_this.texture),_this.gl.texImage2D(_this.gl.TEXTURE_2D,0,_this.gl.RGBA,_this.gl.RGBA,_this.gl.UNSIGNED_BYTE,_this.textureManager.canvas),console.log("textureChange。。"))},this.initPositionValue=function(){var positionV=[0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,1];_this.attrData.a_position.forEach((function(v,ind){var pIndex=ind%16;_this.attrData.a_position[ind]=positionV[pIndex]}))},this.updatePosition=function(elementIndex,position){var startIndex=4*elementIndex*4,x=position[0],y=position[1];_this.attrData.a_position[startIndex+0]=x,_this.attrData.a_position[startIndex+1]=y,_this.attrData.a_position[startIndex+4]=x,_this.attrData.a_position[startIndex+5]=y,_this.attrData.a_position[startIndex+8]=x,_this.attrData.a_position[startIndex+9]=y,_this.attrData.a_position[startIndex+12]=x,_this.attrData.a_position[startIndex+13]=y,_this.positionBufferChanged=!0,_this.update()},this.update=function(){!0!==_this.rafing&&(_this.rafing=!0,requestAnimationFrame((function(){_this.updateImidiatly(),_this.rafing=!1})))},this.updateImage=function(elementIndex,imgId){var startIndex=4*elementIndex*2,_a=_this.textureManager.getImageInfo(imgId),x=_a.x,y=_a.y;_this.attrData.a_texCoord[startIndex]=x,_this.attrData.a_texCoord[startIndex+1]=y,_this.attrData.a_texCoord[startIndex+2]=x,_this.attrData.a_texCoord[startIndex+3]=y,_this.attrData.a_texCoord[startIndex+4]=x,_this.attrData.a_texCoord[startIndex+5]=y,_this.attrData.a_texCoord[startIndex+6]=x,_this.attrData.a_texCoord[startIndex+7]=y,_this.imageIdBufferChanged=!0,_this.update()},this.updateColor=function(elementIndex,color){var startIndex=4*elementIndex*4,r=color[0],g=color[1],b=color[2],fa=255*color[3];_this.attrData.a_color[startIndex]=r,_this.attrData.a_color[startIndex+1]=g,_this.attrData.a_color[startIndex+2]=b,_this.attrData.a_color[startIndex+3]=fa,_this.attrData.a_color[startIndex+4]=r,_this.attrData.a_color[startIndex+5]=g,_this.attrData.a_color[startIndex+6]=b,_this.attrData.a_color[startIndex+7]=fa,_this.attrData.a_color[startIndex+8]=r,_this.attrData.a_color[startIndex+9]=g,_this.attrData.a_color[startIndex+10]=b,_this.attrData.a_color[startIndex+11]=fa,_this.attrData.a_color[startIndex+12]=r,_this.attrData.a_color[startIndex+13]=g,_this.attrData.a_color[startIndex+14]=b,_this.attrData.a_color[startIndex+15]=fa,_this.colorBufferChanged=!0,_this.update()},this.updateScale=function(elementIndex,scale){var startIndex=4*elementIndex*2,x=scale[0],y=scale[1];_this.attrData.a_scale[startIndex]=x,_this.attrData.a_scale[startIndex+1]=y,_this.attrData.a_scale[startIndex+2]=x,_this.attrData.a_scale[startIndex+3]=y,_this.attrData.a_scale[startIndex+4]=x,_this.attrData.a_scale[startIndex+5]=y,_this.attrData.a_scale[startIndex+6]=x,_this.attrData.a_scale[startIndex+7]=y,_this.scaleChange=!0,_this.update()},this.updateRotation=function(elementIndex,rotation){var startIndex=4*elementIndex*1;_this.attrData.a_rotation[startIndex]=rotation,_this.attrData.a_rotation[startIndex+1]=rotation,_this.attrData.a_rotation[startIndex+2]=rotation,_this.attrData.a_rotation[startIndex+3]=rotation,_this.attrData.a_rotation[startIndex+4]=rotation,_this.rotationChange=!0,_this.update()},this.updateSize=function(elementIndex,_a){var w=_a[0],h=_a[1],startIndex=4*elementIndex*2;_this.attrData.a_spriteSize[startIndex]=w,_this.attrData.a_spriteSize[startIndex+1]=h,_this.attrData.a_spriteSize[startIndex+2]=w,_this.attrData.a_spriteSize[startIndex+3]=h,_this.attrData.a_spriteSize[startIndex+4]=w,_this.attrData.a_spriteSize[startIndex+5]=h,_this.attrData.a_spriteSize[startIndex+6]=w,_this.attrData.a_spriteSize[startIndex+7]=h,_this.sizeChanged=!0,_this.update()},this.updateOffset=function(){},this.updateZindex=function(){_this.zIndexChange=!0},this.options=__assign(__assign({},DEFAULT_OPTION),options),this.textureManager=new TextureCanvasManager(this.options.textureSize),this.gl=glCanvas.getContext("webgl",{alpha:!0})||glCanvas.getContext("experimental-webgl"),this.gl.getExtension("OES_element_index_uint");var program=this.gl.createProgram();compileShader(this.gl,program,"\n\n    #define PI 3.14159265358979323846264338327950288\n\n    // gl窗口大小.\n    uniform vec2 u_windowSize;\n\n    // 纹理大小.\n    uniform vec2 u_textureSize;\n\n    // 实际品目坐标.\n    attribute vec4 a_position;\n\n    attribute vec2 a_texCoord;\n\n    attribute vec2 a_scale;\n\n    attribute vec2 a_spriteSize;\n\n    attribute vec2 a_offset;\n\n    // 单位 deg 0-360;\n    attribute float a_rotation;\n\n\n    attribute vec4 a_color;\n\n    varying vec2 v_texCoord;\n\n    \n    varying vec4 v_color;\n\n    float atant2 (float y, float x) {\n\n      if( x > 0.0 ) {\n        return atan(y/x);\n      }\n\n      if ( x == 0.0 ) {\n        return y > 0.0? 0.5 * PI : - 0.5 * PI;\n      }\n\n      return y >= 0.0? (atan(y/x) + PI) : (atan(y/x) - PI);\n    }\n\n\n    vec2 rotateVec2 (float rad, vec2 center, vec2 point) {\n\n      float dist = distance(point, center);\n      float xd = ( point.x - center.x )/dist;\n      float yd = ( point.y - center.y )/dist;\n      float angle = rad + atant2( point.y - center.y, point.x - center.x ); \n      return center + vec2( cos(angle) * dist, sin(angle) * dist );\n    }\n\n    void main() {\n\n        v_color = a_color;\n\n        vec2 spriteSize = a_spriteSize * a_scale;\n\n        vec2 center = vec2(a_position.x, a_position.y);\n\n        vec2 direction = vec2(a_position.z, a_position.w);\n\n        vec2 texCoord = a_texCoord + direction * a_spriteSize;\n\n        v_texCoord =  (texCoord + a_offset )/u_textureSize;\n\n        vec2 position = center + direction * spriteSize -  0.5 * spriteSize;\n\n        float rotation = radians(a_rotation);\n\n        /**\n         *  P1 ++++++ P3\n         *  +         +\n         *  +         +\n         *  P2 ++++++ P4\n         * \n         *  P1 -> P2 -> P3\n         *  P3 -> P2 -> P4\n        */\n        gl_Position = vec4((rotateVec2( rotation, center, position)/u_windowSize *2.0 -1.0) * vec2(1, -1), 1,1);\n\n    }\n",SHADER_TYPE.VERTEX_SHADER),compileShader(this.gl,program,"\n    precision highp float;\n\n    uniform sampler2D u_image;\n\n    varying vec2 v_texCoord;\n\n    varying vec4 v_color;\n\n    void main(){\n        vec4 textColor = texture2D(u_image, v_texCoord);\n        gl_FragColor = textColor * vec4( v_color.r, v_color.g, v_color.b, 1 ) * v_color.a; \n    }\n",SHADER_TYPE.FRAGMENT_SHADER),this.gl.linkProgram(program),console.log("getProgramInfoLog:",this.gl.getProgramInfoLog(program)),this.gl.useProgram(program),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.uniformLocations={u_windowSize:this.gl.getUniformLocation(program,"u_windowSize"),u_textureSize:this.gl.getUniformLocation(program,"u_textureSize")},this.attribuitesLocations={a_position:this.gl.getAttribLocation(program,"a_position"),a_spriteSize:this.gl.getAttribLocation(program,"a_spriteSize"),a_texCoord:this.gl.getAttribLocation(program,"a_texCoord"),a_color:this.gl.getAttribLocation(program,"a_color"),a_rotation:this.gl.getAttribLocation(program,"a_rotation"),a_scale:this.gl.getAttribLocation(program,"a_scale")},this.initBuffer(),this.initTexture(),this.setViewPort()}return IRender.prototype.initTexture=function(){this.gl.uniform2f(this.uniformLocations.u_textureSize,this.options.textureSize,this.options.textureSize),this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texParameterf(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameterf(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameterf(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameterf(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.textureManager.canvas)},IRender.prototype.initBuffer=function(){var _this=this;Float32Array.prototype.forEach=Float32Array.prototype.forEach||Array.prototype.forEach,Uint8Array.prototype.forEach=Uint8Array.prototype.forEach||Array.prototype.forEach,Uint32Array.prototype.forEach=Uint32Array.prototype.forEach||Array.prototype.forEach,this.attrData={a_position:new Float32Array(4*this.options.maxNumber*4),a_spriteSize:new Float32Array(4*this.options.maxNumber*2),a_texCoord:new Float32Array(4*this.options.maxNumber*2),a_color:new Uint8Array(4*this.options.maxNumber*4),a_scale:new Float32Array(4*this.options.maxNumber*2),a_rotation:new Float32Array(4*this.options.maxNumber*1),indicate:new Uint32Array(6*this.options.maxNumber)},this.initPositionValue(),this.attrData.indicate.forEach((function(v,ind){var val=ind%6,base=4*Math.floor(ind/6);_this.attrData.indicate[ind]=base+[0,1,2,2,1,3][val]}));var positionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attrData.a_position,this.gl.STREAM_DRAW),this.gl.enableVertexAttribArray(this.attribuitesLocations.a_position),this.gl.vertexAttribPointer(this.attribuitesLocations.a_position,4,this.gl.FLOAT,!1,0,0);var sizeBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,sizeBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attrData.a_spriteSize,this.gl.STREAM_DRAW),this.gl.enableVertexAttribArray(this.attribuitesLocations.a_spriteSize),this.gl.vertexAttribPointer(this.attribuitesLocations.a_spriteSize,2,this.gl.FLOAT,!1,0,0);var texCoord=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,texCoord),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attrData.a_texCoord,this.gl.STREAM_DRAW),this.gl.enableVertexAttribArray(this.attribuitesLocations.a_texCoord),this.gl.vertexAttribPointer(this.attribuitesLocations.a_texCoord,2,this.gl.FLOAT,!1,0,0);var color=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,color),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attrData.a_color,this.gl.STREAM_DRAW),this.gl.enableVertexAttribArray(this.attribuitesLocations.a_color),this.gl.vertexAttribPointer(this.attribuitesLocations.a_color,4,this.gl.UNSIGNED_BYTE,!0,0,0);var scale=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,scale),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attrData.a_scale,this.gl.STREAM_DRAW),this.gl.enableVertexAttribArray(this.attribuitesLocations.a_scale),this.gl.vertexAttribPointer(this.attribuitesLocations.a_scale,2,this.gl.FLOAT,!1,0,0);var rotation=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,rotation),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attrData.a_rotation,this.gl.STREAM_DRAW),this.gl.enableVertexAttribArray(this.attribuitesLocations.a_rotation),this.gl.vertexAttribPointer(this.attribuitesLocations.a_rotation,1,this.gl.FLOAT,!1,0,0);var indicate=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,indicate),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.attrData.indicate,this.gl.STATIC_DRAW),this.attrBuffer={a_position:positionBuffer,a_spriteSize:sizeBuffer,a_texCoord:texCoord,a_color:color,a_scale:scale,a_rotation:rotation}},IRender.prototype.setViewPort=function(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.uniform2f(this.uniformLocations.u_windowSize,this.gl.canvas.width,this.gl.canvas.height)},IRender.prototype.createElement=function(params){var handle={updatePosition:this.updatePosition,updateImg:this.updateImage,updateColor:this.updateColor,updateZindex:this.updateZindex,updateScale:this.updateScale,updateRotation:this.updateRotation,updateSize:this.updateSize,updateOffset:this.updateOffset};if(this.elementPool.size<=0){(el=new Iimage(handle)).elementIndex=this.elementList.length,this.elementList.push(el),this.updateZindex(),el.setPosition.apply(el,params.position),el.setImgId(params.imgId),el.setColor.apply(el,params.color||[255,255,255,1]),el.setRotation(0),el.setScale(1,1);var _a=this.textureManager.getImageInfo(el.imgId),w=_a.w,h=_a.h;return el.setTextureSize(w,h),el.setSize(w,h),el}var el=Array.from(this.elementPool)[0];for(var attr in this.elementPool.delete(el),el.color[0]=255,el.color[1]=255,el.color[2]=255,el.color[3]=255,params)el[attr]=params;this.elementList.push(el),this.updateZindex(),this.updatePosition(el.elementIndex,el.position),this.updateImage(el.elementIndex,el.imgId),this.updateColor(el.elementIndex,el.color),el.setScale(1,1);var _b=this.textureManager.getImageInfo(el.imgId);w=_b.w,h=_b.h;return el.setTextureSize(w,h),el.setSize(w,h),el},IRender.prototype.destoryElement=function(ele){var ind=this.elementList.findIndex((function(el){return el===ele}));if(ind>-1){var deleted=this.elementList.splice(ind,1)[0];this.elementPool.add(deleted),deleted.position[0]=Number.MIN_VALUE,deleted.position[1]=Number.MIN_VALUE}},IRender.prototype.loadImg=function(imgs){var ids=this.textureManager.setImage(imgs);return this.textureChange=!0,ids},IRender.prototype.handleZindexChange=function(){var _this=this;this.zIndexChange&&(this.elementList.sort((function(el1,el2){return el1.zIndex-el2.zIndex})),this.elementList.forEach((function(el,index){index!==el.elementIndex&&(el.elementIndex=index,_this.updatePosition(index,el.position),_this.updateImage(index,el.imgId),_this.updateColor(index,el.color))})),this.zIndexChange=!1)},IRender}()},921:function(module,exports,__webpack_require__){var map={"./game.sb.tsx":922,"./i-render.sb.tsx":926,"./surfing.sb.tsx":929};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=921},922:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Run",(function(){return Run}));__webpack_require__(30),__webpack_require__(33),__webpack_require__(40),__webpack_require__(100),__webpack_require__(923),__webpack_require__(351),__webpack_require__(58),__webpack_require__(350),__webpack_require__(32),__webpack_require__(102),__webpack_require__(44),__webpack_require__(34),__webpack_require__(45),__webpack_require__(106);var react__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_14__),i_render__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(84),_assets_player2_stand1_png__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(355),_assets_player2_stand1_png__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_assets_player2_stand1_png__WEBPACK_IMPORTED_MODULE_16__),_assets_player2_run1_png__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(356),_assets_player2_run1_png__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(_assets_player2_run1_png__WEBPACK_IMPORTED_MODULE_17__),_assets_player2_run2_png__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(357),_assets_player2_run2_png__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_assets_player2_run2_png__WEBPACK_IMPORTED_MODULE_18__),_assets_player2_run3_png__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(358),_assets_player2_run3_png__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_assets_player2_run3_png__WEBPACK_IMPORTED_MODULE_19__),_assets_player2_run4_png__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(359),_assets_player2_run4_png__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(_assets_player2_run4_png__WEBPACK_IMPORTED_MODULE_20__),_assets_player2_run5_png__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(360),_assets_player2_run5_png__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(_assets_player2_run5_png__WEBPACK_IMPORTED_MODULE_21__),_assets_player2_run6_png__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(361),_assets_player2_run6_png__WEBPACK_IMPORTED_MODULE_22___default=__webpack_require__.n(_assets_player2_run6_png__WEBPACK_IMPORTED_MODULE_22__),_assets_player2_run7_png__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(362),_assets_player2_run7_png__WEBPACK_IMPORTED_MODULE_23___default=__webpack_require__.n(_assets_player2_run7_png__WEBPACK_IMPORTED_MODULE_23__),_fps__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(22);__webpack_require__(924);function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function loadImage(iRender,url){var img=new Image;return img.src=url,new Promise((function(r){img.onload=function(){var id=iRender.loadImg(img);r(id)}}))}function _init(){return(_init=_asyncToGenerator(regeneratorRuntime.mark((function _callee(iRender,runId,curRunId,_ref){var total,scale,xCount,stand,runUrlList,runAnimIds,cur,playerList,i,x,y,player,lastTime,run;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return total=_ref.total,scale=_ref.scale,xCount=_ref.xCount,_context.next=3,loadImage(iRender,_assets_player2_stand1_png__WEBPACK_IMPORTED_MODULE_16___default.a);case 3:return stand=_context.sent,runUrlList=[_assets_player2_run1_png__WEBPACK_IMPORTED_MODULE_17___default.a,_assets_player2_run2_png__WEBPACK_IMPORTED_MODULE_18___default.a,_assets_player2_run3_png__WEBPACK_IMPORTED_MODULE_19___default.a,_assets_player2_run4_png__WEBPACK_IMPORTED_MODULE_20___default.a,_assets_player2_run5_png__WEBPACK_IMPORTED_MODULE_21___default.a,_assets_player2_run6_png__WEBPACK_IMPORTED_MODULE_22___default.a,_assets_player2_run7_png__WEBPACK_IMPORTED_MODULE_23___default.a],_context.next=7,Promise.all(runUrlList.map((function(url){return loadImage(iRender,url)})));case 7:for(runAnimIds=(runAnimIds=_context.sent).concat(runAnimIds.reverse()).reverse(),cur=0,playerList=[],i=0;i<total;i++)x=120*scale*Math.floor(i%xCount)+60*scale,y=140*scale*Math.floor(i/xCount)+60*scale,(player=iRender.createElement({imgId:stand,position:[x,y]})).setScale(-scale,scale),playerList.push(player);lastTime=.001*Date.now(),(run=function(runId){var now=.001*Date.now();if(.07<=now-lastTime){var ind=cur++%runAnimIds.length;playerList.forEach((function(player,playerInd){var cc=runAnimIds[(ind+playerInd)%runAnimIds.length];player.setImgId(cc)})),lastTime=now}runId===curRunId.runId&&requestAnimationFrame((function(){return run(runId)}))})(runId);case 15:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}__webpack_exports__.default={title:"Run RENDER",component:Run};var _ref2=react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("p",{id:"fps"});function Run(){var renderRef=Object(react__WEBPACK_IMPORTED_MODULE_14__.useRef)(),canvasRef=Object(react__WEBPACK_IMPORTED_MODULE_14__.useRef)(),wrapRef=Object(react__WEBPACK_IMPORTED_MODULE_14__.useRef)(),_useState2=_slicedToArray(Object(react__WEBPACK_IMPORTED_MODULE_14__.useState)(2e4),2),total=_useState2[0],setTotal=_useState2[1],_useState4=_slicedToArray(Object(react__WEBPACK_IMPORTED_MODULE_14__.useState)(110),2),xCount=_useState4[0],setXCount=_useState4[1],_useState6=_slicedToArray(Object(react__WEBPACK_IMPORTED_MODULE_14__.useState)(1),2),scale=_useState6[0],setScale=_useState6[1],cancelHandleRef=Object(react__WEBPACK_IMPORTED_MODULE_14__.useRef)({runId:0});return Object(react__WEBPACK_IMPORTED_MODULE_14__.useEffect)((function(){var canvas=canvasRef.current;if(canvas)return cancelHandleRef.current.runId++,Object(_fps__WEBPACK_IMPORTED_MODULE_24__.b)(),console.log("cancelHandleRef.current.runId",cancelHandleRef.current.runId),canvas.width=document.documentElement.clientWidth,canvas.height=document.documentElement.clientHeight,renderRef.current=new i_render__WEBPACK_IMPORTED_MODULE_15__.a(canvas,{maxNumber:2e5}),function init(){return _init.apply(this,arguments)}(renderRef.current,cancelHandleRef.current.runId,cancelHandleRef.current,{total:total,scale:scale,xCount:xCount}),Object(_fps__WEBPACK_IMPORTED_MODULE_24__.a)(),function(){cancelHandleRef.current.runId++,Object(_fps__WEBPACK_IMPORTED_MODULE_24__.b)()}}),[total,xCount,scale]),react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("div",{ref:wrapRef},react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("div",{className:"game_Wrap",style:{}},_ref2,react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("div",{className:"item"},"总数量： ",react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("input",{type:"range",min:"500",max:"200000",step:"1",value:total,onChange:function onChange(e){return setTotal(+e.target.value)}})," ",total),react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("div",{className:"item"},"列数：  ",react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("input",{type:"range",min:"10",max:"200",step:"1",value:xCount,onChange:function onChange(e){return setXCount(+e.target.value)}})," ",xCount),react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("div",{className:"item"},"缩放：",react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("input",{type:"range",min:"0.01",max:"1",step:"0.01",value:scale,onChange:function onChange(e){return setScale(+e.target.value)}})," ",scale)),react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("canvas",{ref:canvasRef,style:{width:"100%",height:"100%"}}))}Run.displayName="Run",Run.__docgenInfo={description:"",methods:[],displayName:"Run"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories\\game.sb.tsx"]={name:"Run",docgenInfo:Run.__docgenInfo,path:"stories\\game.sb.tsx"})},924:function(module,exports,__webpack_require__){var api=__webpack_require__(198),content=__webpack_require__(925);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},925:function(module,exports,__webpack_require__){(exports=__webpack_require__(199)(!1)).push([module.i,".game_Wrap {\n  position: fixed;\n   bottom: 0;\n left: 0;\n right: 0;\n margin:0;\n padding: 0;\n padding-bottom: 20;\n opacity: 0.7;\n color: white;\n background: black;\n display: flex;\n flex-direction: column\n}\n\n.game_Wrap .item {\n  display: flex;\n  margin: 5px;\n}\n\n.game_Wrap .item input {\n  flex: 1 1;\n}\n\n#fps{\n  min-height: 22; \n  margin: 0;\n  padding: 0;\n}",""]),module.exports=exports},926:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Test",(function(){return Test})),__webpack_require__.d(__webpack_exports__,"PerformenceTest",(function(){return PerformenceTest})),__webpack_require__.d(__webpack_exports__,"Canvas2dPerformenceTest",(function(){return Canvas2dPerformenceTest})),__webpack_require__.d(__webpack_exports__,"ColorTest",(function(){return ColorTest})),__webpack_require__.d(__webpack_exports__,"zIndexTest",(function(){return zIndexTest})),__webpack_require__.d(__webpack_exports__,"TextureTest",(function(){return TextureTest}));__webpack_require__(352),__webpack_require__(33),__webpack_require__(124),__webpack_require__(34);var react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_4__),i_render__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(84),_fps__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(22);__webpack_require__(353);__webpack_exports__.default={title:"Demo RENDER",component:Test};var _ref=react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",null,"test...");function Test(){return _ref}Test.displayName="Test";var _ref2=react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",{id:"fps"});function PerformenceTest(){var cRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),textureRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),glRenderRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)();return Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){var glRender=new i_render__WEBPACK_IMPORTED_MODULE_5__.a(cRef.current,{maxNumber:85e3});glRenderRef.current=glRender;var circle=document.createElement("canvas");circle.width=100,circle.height=100;var ctx=circle.getContext("2d");ctx.fillStyle="rgba(50,255,255,0.2)",ctx.lineWidth=0,ctx.arc(50,50,50,0,2*Math.PI),ctx.fill();var circleImgId=glRender.loadImg(circle);ctx.clearRect(0,0,100,100),ctx.fillStyle="rgba(255,125,125,0.2)",ctx.arc(50,50,50,0,2*Math.PI),ctx.fill();for(var halfImgId=glRender.loadImg(circle),reqH={a:0},list=[],i=0;i<850;i++)for(var j=0;j<100;j++)list.push(glRender.createElement({imgId:list.length%2?circleImgId:halfImgId,position:[50*(i+1),50*(j+1)]}));console.log("total:",list.length);var frameCount=0;function update(el,i){el.setImgId((frameCount+i)%60?circleImgId:halfImgId)}var req=function(){frameCount++,list.forEach(update),reqH.a=requestAnimationFrame(req)};return req(),Object(_fps__WEBPACK_IMPORTED_MODULE_6__.a)(),function(){Object(_fps__WEBPACK_IMPORTED_MODULE_6__.b)(),cancelAnimationFrame(reqH.a)}}),[]),Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){textureRef.current.getContext("2d").drawImage(glRenderRef.current.getTexture(),0,0,200,200,0,0,200,200)}),[]),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:cRef,width:2800,height:1300,style:{width:2800/devicePixelRatio,height:1300/devicePixelRatio,backgroundColor:"rgb(122,122,122,1)"}}),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:textureRef,width:200,height:200,style:{backgroundColor:"rgb(122,122,122,1)"}}),_ref2)}function Canvas2dPerformenceTest(){var cRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),textureRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)();Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)();return Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){console.log("total:",85e3);var canvas=cRef.current;if(canvas){var ctx=canvas.getContext("2d"),reqH={a:0};ctx.fillStyle="rgba(255,125,0,0.3)";var req=function(){ctx.clearRect(0,0,canvas.width,canvas.height);for(var i=0;i<850;i++)for(var j=0;j<100;j++)ctx.beginPath(),ctx.arc(50*i*.3,50*j*.3,50,0,2*Math.PI),ctx.fill();reqH.a=requestAnimationFrame(req)};return Object(_fps__WEBPACK_IMPORTED_MODULE_6__.a)(),req(),function(){Object(_fps__WEBPACK_IMPORTED_MODULE_6__.b)(),cancelAnimationFrame(reqH.a)}}}),[]),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:cRef,width:2800,height:1300,style:{width:2800/devicePixelRatio,height:1300/devicePixelRatio,backgroundColor:"rgb(122,122,122,1)"}}),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:textureRef,width:200,height:200,style:{backgroundColor:"rgb(122,122,122,1)"}}),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",{id:"fps",style:{backgroundColor:"white",position:"fixed",left:0,top:0}}))}function ColorTest(){var cRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),textureRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),glRenderRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)();return Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){var glRender=new i_render__WEBPACK_IMPORTED_MODULE_5__.a(cRef.current,{});glRenderRef.current=glRender;var circle=document.createElement("canvas");circle.width=100,circle.height=100;var ctx=circle.getContext("2d");ctx.fillStyle="rgba(255, 255, 255, 1)",ctx.strokeStyle="rgba(0,0,255, 1)",ctx.lineWidth=10,ctx.arc(50,50,40,0,2*Math.PI),ctx.fill();var whiteId=glRender.loadImg(circle);ctx.clearRect(0,0,100,100),ctx.fillStyle="rgba(255,0,0,0.8)",ctx.arc(50,50,50,0,2*Math.PI),ctx.fill();var redId=glRender.loadImg(circle),reqH_a=0;return glRender.createElement({imgId:redId,position:[150,50]}),glRender.createElement({imgId:redId,position:[2.3*50,50]}),glRender.createElement({imgId:whiteId,position:[50,50],color:[255,0,0,.8]}),glRender.createElement({imgId:whiteId,position:[25,25],color:[255,0,0,.8]}),function(){cancelAnimationFrame(reqH_a)}}),[]),Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){textureRef.current.getContext("2d").drawImage(glRenderRef.current.getTexture(),0,0,200,200,0,0,200,200)}),[]),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:cRef,width:2800,height:1300,style:{width:2800/devicePixelRatio,height:1300/devicePixelRatio,backgroundColor:"rgb(122,122,122,1)"}}),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:textureRef,width:200,height:200,style:{backgroundColor:"rgb(122,122,122,1)"}}),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",{id:"fps",style:{backgroundColor:"white",position:"fixed",left:0,top:0}}))}function zIndexTest(){var cRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),textureRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),glRenderRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)();return Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){var glRender=new i_render__WEBPACK_IMPORTED_MODULE_5__.a(cRef.current,{maxNumber:30});glRenderRef.current=glRender;var circle=document.createElement("canvas");circle.width=100,circle.height=100;var ctx=circle.getContext("2d");ctx.fillStyle="rgba(255,255,255,1)",ctx.lineWidth=0,ctx.fillRect(0,0,100,100);var cirle=glRender.loadImg(circle),green=glRender.createElement({imgId:cirle,position:[150,75],color:[0,255,0,.8]}),red=glRender.createElement({imgId:cirle,position:[75,75],color:[255,0,0,.8]});glRender.createElement({imgId:cirle,position:[112.5,125],color:[0,0,255,.8]});return green.setZIndex(2),red.setZIndex(3),Object(_fps__WEBPACK_IMPORTED_MODULE_6__.a)(),function(){Object(_fps__WEBPACK_IMPORTED_MODULE_6__.b)()}}),[]),Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){textureRef.current.getContext("2d").drawImage(glRenderRef.current.getTexture(),0,0,200,200,0,0,200,200)}),[]),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:cRef,width:2800,height:1300,style:{width:2800/devicePixelRatio,height:1300/devicePixelRatio,backgroundColor:"rgb(122,122,122,1)"}}),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:textureRef,width:200,height:200,style:{backgroundColor:"rgb(122,122,122,1)"}}),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",{id:"fps",style:{backgroundColor:"white",position:"fixed",left:0,top:0}}))}function TextureTest(){var cRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),wrapRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),textureRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)(),glRenderRef=Object(react__WEBPACK_IMPORTED_MODULE_4__.useRef)();return Object(react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((function(){var glRender=new i_render__WEBPACK_IMPORTED_MODULE_5__.a(cRef.current,{maxNumber:85e3});glRenderRef.current=glRender;var numberIdMap=function(){var glRender=glRenderRef.current,imgIdMap={},canvas=document.createElement("canvas");canvas.width=80,canvas.height=50;var ctx=canvas.getContext("2d");ctx.textAlign="left",ctx.textBaseline="top",ctx.fillStyle="red",ctx.font="50px 微软雅黑";for(var t=1;1e3>t;t++)ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillText(t+"",0,0,80),imgIdMap[t]=glRender.loadImg(canvas);return imgIdMap}();if(wrapRef.current){var cc=glRenderRef.current.getTexture();cc.style.width="1000px",wrapRef.current.appendChild(cc)}Object.values(numberIdMap).forEach((function(imgId,indx){var y=100*(.5+Math.floor(indx/28)),el=glRender.createElement({position:[100*(indx%28+.5),y],imgId:imgId});el.setRotation(45),el.setScale(1,-1)}))}),[]),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",{ref:wrapRef},react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:cRef,width:2800,height:1300,style:{width:2800/devicePixelRatio,height:1300/devicePixelRatio,backgroundColor:"rgb(122,122,122,1)"}}),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("canvas",{ref:textureRef,width:200,height:200,style:{backgroundColor:"rgb(122,122,122,1)"}}),react__WEBPACK_IMPORTED_MODULE_4___default.a.createElement("div",{id:"fps",style:{backgroundColor:"white",position:"fixed",left:0,top:0}}))}PerformenceTest.displayName="PerformenceTest",Canvas2dPerformenceTest.displayName="Canvas2dPerformenceTest",ColorTest.displayName="ColorTest",zIndexTest.displayName="zIndexTest",TextureTest.displayName="TextureTest",Test.__docgenInfo={description:"",methods:[],displayName:"Test"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories\\i-render.sb.tsx"]={name:"Test",docgenInfo:Test.__docgenInfo,path:"stories\\i-render.sb.tsx"}),PerformenceTest.__docgenInfo={description:"",methods:[],displayName:"PerformenceTest"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories\\i-render.sb.tsx"]={name:"PerformenceTest",docgenInfo:PerformenceTest.__docgenInfo,path:"stories\\i-render.sb.tsx"}),Canvas2dPerformenceTest.__docgenInfo={description:"",methods:[],displayName:"Canvas2dPerformenceTest"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories\\i-render.sb.tsx"]={name:"Canvas2dPerformenceTest",docgenInfo:Canvas2dPerformenceTest.__docgenInfo,path:"stories\\i-render.sb.tsx"}),ColorTest.__docgenInfo={description:"",methods:[],displayName:"ColorTest"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories\\i-render.sb.tsx"]={name:"ColorTest",docgenInfo:ColorTest.__docgenInfo,path:"stories\\i-render.sb.tsx"}),zIndexTest.__docgenInfo={description:"",methods:[],displayName:"zIndexTest"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories\\i-render.sb.tsx"]={name:"zIndexTest",docgenInfo:zIndexTest.__docgenInfo,path:"stories\\i-render.sb.tsx"}),TextureTest.__docgenInfo={description:"",methods:[],displayName:"TextureTest"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories\\i-render.sb.tsx"]={name:"TextureTest",docgenInfo:TextureTest.__docgenInfo,path:"stories\\i-render.sb.tsx"})},928:function(module,exports,__webpack_require__){(exports=__webpack_require__(199)(!1)).push([module.i,"#fps{\n  background: black;\n  color: white;\n  padding: 2px;\n  opacity: 0.5;\n  position: fixed;\n  left: 0;\n  top: 0;\n  min-width: 57px;\n  min-height: 26px;\n}",""]),module.exports=exports},929:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Surfing",(function(){return Surfing}));__webpack_require__(352),__webpack_require__(33),__webpack_require__(351),__webpack_require__(58),__webpack_require__(66),__webpack_require__(34);var react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_6__),i_render__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(84),_fps__WEBPACK_IMPORTED_MODULE_10__=(__webpack_require__(930),__webpack_require__(353),__webpack_require__(22));function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(iter))return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)(descriptor=props[i]).enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}__webpack_exports__.default={title:"Surfing",component:Surfing};var SurfingElementObj=function(){function SurfingElementObj(img){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SurfingElementObj),this.img=img,_defineProperty(this,"v",[0,-10]),_defineProperty(this,"INIT_A",[0,-50]),_defineProperty(this,"a",[10,-500]),_defineProperty(this,"color",void 0),this.a[0]=this.INIT_A[0],this.a[1]=this.INIT_A[1],this.color=_toConsumableArray(img.color)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(SurfingElementObj,[{key:"update",value:function update(deltaTime){this.v[0]+=this.a[0]*deltaTime,this.v[1]+=this.a[1]*deltaTime,this.v[0]=Math.min(Math.max(this.v[0],-200),200);var _this$img$position=_slicedToArray(this.img.position,2),x=_this$img$position[0],y=_this$img$position[1];this.img.setPosition(this.v[0]*deltaTime+x,this.v[1]*deltaTime+y);var _this$img$color=_slicedToArray(this.img.color,4),r=_this$img$color[0],g=_this$img$color[1],b=_this$img$color[2],a=_this$img$color[3],_this$color=_slicedToArray(this.color,4),tR=_this$color[0],tG=_this$color[1],tB=_this$color[2],tA=_this$color[3];this.img.setColor(.5*(tR-r)*deltaTime+r,.5*(tG-g)*deltaTime+g,.5*(tB-b)*deltaTime+b,.5*(tA-a)*deltaTime+a)}}]),SurfingElementObj}();function surfingAnim(surfingElementObjList,w,h,point,deltaTime){var _point=_slicedToArray(point,3),pX=_point[0],pY=_point[1],pR=_point[2];surfingElementObjList.forEach((function(surfingElementObj){var _surfingElementObj$im=_slicedToArray(surfingElementObj.img.position,2),x=_surfingElementObj$im[0],y=_surfingElementObj$im[1],vy=.002*(h-y),random=Math.random();surfingElementObj.a[0]=200*(.5>random?1:-1),-10>(y-=1>vy?1:vy)&&(y=h,x=Math.random()*w,surfingElementObj.img.setPosition(x,y),surfingElementObj.a[1]=surfingElementObj.INIT_A[1],surfingElementObj.v[0]=0,surfingElementObj.v[1]=500*-random);var dist=function distance(p1,p2){return Math.sqrt(Math.pow(p2[0]-p1[0],2)+Math.pow(p2[1]-p1[1],2))}([pX,pY],surfingElementObj.img.position),r=.5*surfingElementObj.img.size[0];dist<=pR+r&&(surfingElementObj.v[0]=pX>x?-200:200,surfingElementObj.img.setColor(10*random+245,30*Math.random()+220,20*Math.random()+200,1)),x<=r&&(surfingElementObj.v[0]=Math.abs(surfingElementObj.v[0])),x>=w-r&&(surfingElementObj.v[0]=-Math.abs(surfingElementObj.v[0])),surfingElementObj.update(deltaTime)}))}var _ref=react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{id:"fps"});function Surfing(){var canvasRef=Object(react__WEBPACK_IMPORTED_MODULE_6__.useRef)(),irenderRef=Object(react__WEBPACK_IMPORTED_MODULE_6__.useRef)();return Object(react__WEBPACK_IMPORTED_MODULE_6__.useEffect)((function(){var canvas=canvasRef.current;if(canvas){irenderRef.current=new i_render__WEBPACK_IMPORTED_MODULE_7__.a(canvas,{maxNumber:25001,backgroundColor:[1,.5,.5,1]});var circleTextureId=function loadCircle(irender,r){var tempTexture=document.createElement("canvas");tempTexture.width=2*r,tempTexture.height=2*r;var tempCtx=tempTexture.getContext("2d");return tempCtx.fillStyle="rgba(255,255, 255, 1)",tempCtx.arc(r,r,r,0,2*Math.PI),tempCtx.fill(),irender.loadImg(tempTexture)}(irenderRef.current,100),surfingElementObjList=function createSurfingElementObj(irender,smockId,num){for(var surfingElementObjList=[],i=0;i<num;i++){var surfingElement=irender.createElement({imgId:smockId,position:[Math.random()*irender.glCanvas.width,0]}),scale=.05*Math.random()+.05;surfingElement.setScale(scale,scale),surfingElement.setColor(127*Math.random()+117,127+117*Math.random(),127*Math.random()+118,1);var obj=new SurfingElementObj(surfingElement);surfingElementObjList.push(obj)}return surfingElementObjList}(irenderRef.current,circleTextureId,25e3),point=[.5*canvas.width,.5*canvas.height,35],pointImg=irenderRef.current.createElement({imgId:circleTextureId,position:[point[0],point[1]]});pointImg.setColor(255,200,0,1),pointImg.setScale(.35,.35),canvas.addEventListener("mousemove",(function(e){point[0]=e.clientX*devicePixelRatio,point[1]=e.clientY*devicePixelRatio,pointImg.setPosition(point[0],point[1])})),canvas.addEventListener("touchmove",(function(e){e.preventDefault();var p=e.touches[0];point[0]=p.clientX*devicePixelRatio,point[1]=(p.clientY-100)*devicePixelRatio,pointImg.setPosition(point[0],point[1])}),{passive:!1});var reqHandle={id:0,deltaTime:0},lastTime=.001*Date.now(),start=function(){var now=.001*Date.now();reqHandle.deltaTime=now-lastTime,lastTime=now,surfingAnim(surfingElementObjList,canvas.width,canvas.height,point,reqHandle.deltaTime),reqHandle.id=requestAnimationFrame(start)};return start(),Object(_fps__WEBPACK_IMPORTED_MODULE_10__.a)(),function(){cancelAnimationFrame(reqHandle.id),Object(_fps__WEBPACK_IMPORTED_MODULE_10__.b)()}}}),[]),react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",null,_ref,react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"pannel"},"粒子数量：",25e3),react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("canvas",{ref:canvasRef,style:{width:"100%",height:"100%"},width:document.documentElement.clientWidth*window.devicePixelRatio,height:document.documentElement.clientHeight*window.devicePixelRatio}))}Surfing.displayName="Surfing",Surfing.__docgenInfo={description:"",methods:[],displayName:"Surfing"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["stories\\surfing.sb.tsx"]={name:"Surfing",docgenInfo:Surfing.__docgenInfo,path:"stories\\surfing.sb.tsx"})},930:function(module,exports,__webpack_require__){var api=__webpack_require__(198),content=__webpack_require__(931);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},931:function(module,exports,__webpack_require__){(exports=__webpack_require__(199)(!1)).push([module.i,"body{\n  margin: 0;\n  padding: 0;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  overflow: hidden;\n  \n}\n\n.pannel {\n  position: fixed;\n  top: 0;\n  right: 0;\n  background-color: black;\n  opacity: 0.5;\n  color: white;\n  padding: 5px;\n  z-index: 10;\n}\n/* \n */\n\n/* canvas{\n  background: black;\n} */\n\n",""]),module.exports=exports}},[[363,1,2]]]);
//# sourceMappingURL=main.2121c6997bc5c476763a.bundle.js.map